<div class="header-container light-theme">

<div class="header"><ql-icon-button class="js-nav-toggle header__nav-panel-button l-mrm">menu</ql-icon-button>

<div class="header__title">[<ql-icon>arrow_back</ql-icon>](https://google.qwiklabs.com/quests/128?qlcampaign=1m-freelabs-456%3Futm_source%3Dgoogle)

# Build and Secure Networks in Google Cloud: Challenge Lab

</div>

<div class="header__actions"><ql-icon-button class="header__button--search js-header-search-bar-button">search</ql-icon-button> [<ql-icon>favorite_border</ql-icon>](/favorite.json?item_id=12068&item_type=CatalogItem&qlcampaign=1m-freelabs-456%3Futm_source%3Dgoogle)

<div class="mdl-tooltip js-tooltip" for="CatalogItem-12068-favorite-button">Add to favorites</div>

<ql-icon-button id="control-panel-target" style="display: none;">dashboard</ql-icon-button> <ql-icon-button id="help-menu-button">help</ql-icon-button>

<div class="mdl-tooltip js-tooltip" data-mdl-for="help-menu-button">Help</div>

<ql-menu for="#help-menu-button" id="help-menu"><ql-menu-item><ql-help context="lab" data-analytics-action="opened_help" data-analytics-label="lab" productdata="{&quot;userId&quot;:4061609}">Help Center</ql-help> </ql-menu-item><ql-menu-item>[Email support](https://support.google.com/qwiklabs/contact/contact_us)</ql-menu-item> <ql-menu-item><a class="ql-body-1" onclick="ql.chat.open()">Chat support</a></ql-menu-item></ql-menu><button class="icon-button" id="my_account"><ql-avatar src="https://lh3.googleusercontent.com/a-/AOh14GhQq4o2edVnaxPhba-uHo4quEhqCkrVJHbCxFDxkg=s320-c"></ql-avatar></button><ql-menu for="#my_account" open="">

<div class="my-account-menu"><ql-avatar class="l-mtl l-mbl" size="120" src="https://lh3.googleusercontent.com/a-/AOh14GhQq4o2edVnaxPhba-uHo4quEhqCkrVJHbCxFDxkg=s320-c"></ql-avatar>

<div class="my-account-menu__user-info l-mbl">

#### jose luis

josloe@gmail.com

[<ql-chip positive="">Monthly Subscription</ql-chip>](/my_account/payments?qlcampaign=1m-freelabs-456%3Futm_source%3Dgoogle)</div>

<div class="buttons l-mbl">[Settings](/my_account/profile?qlcampaign=1m-freelabs-456%3Futm_source%3Dgoogle)</div>

* * *

<ql-button data-analytics-action="clicked_sign_out" href="/users/sign_out?qlcampaign=1m-freelabs-456%3Futm_source%3Dgoogle" method="delete">Sign Out</ql-button>

<div class="privacy l-mtl">[Privacy](/privacy_policy?qlcampaign=1m-freelabs-456%3Futm_source%3Dgoogle) <span class="ql-caption text--light l-mls l-mrs">·</span> [Terms](/terms_of_service?qlcampaign=1m-freelabs-456%3Futm_source%3Dgoogle)</div>

</div>

</ql-menu></div>

</div>

<div class="header__search-bar js-header-search-bar">

<form class="js-search-form-mobile" onsubmit="ql.searchFilter(); return false;" action="/searches/elasticsearch" accept-charset="UTF-8" method="post"><input name="utf8" type="hidden" value="✓"><input type="hidden" name="authenticity_token" value="dGO0iThZ91tBykxZ2fXYbBILJdthsjM3pUlCMo7T2iXq1MS+AfIBDJKzdJJ8p2t4NOP4HhTa4RYxJhwdYyVaPg=="> <input type="text" name="keywords" id="keywords" placeholder="Search" maxlength="255" aria-label="catalog search bar"></form>

<ql-icon-button class="js-close-search-bar">close</ql-icon-button></div>

</div>

<nav class="nav-bar">[<ql-icon class="nav-bar__item__icon">home</ql-icon> <span class="nav-bar__item__label">Home</span> ](/?qlcampaign=1m-freelabs-456%3Futm_source%3Dgoogle)[<ql-icon class="nav-bar__item__icon">school</ql-icon> <span class="nav-bar__item__label">Catalog</span> ](/catalog?qlcampaign=1m-freelabs-456%3Futm_source%3Dgoogle)[<ql-icon class="nav-bar__item__icon">event_note</ql-icon> <span class="nav-bar__item__label">My Learning</span>](/my_learning?qlcampaign=1m-freelabs-456%3Futm_source%3Dgoogle)</nav>

<nav class="nav-panel js-nav-panel">

<div class="nav-panel__logo">

<div class="custom-logo">![](https://storage.googleapis.com/qwiklabs-cdn-bucket-d8612e07d1cc/logos/GoogleCloudTraining.svg)</div>

</div>

[<ql-icon class="nav-panel__item__icon">home</ql-icon>

<div class="nav-panel__item__label">Home</div>

](/?qlcampaign=1m-freelabs-456%3Futm_source%3Dgoogle "Home")[<ql-icon class="nav-panel__item__icon">school</ql-icon>

<div class="nav-panel__item__label">Catalog</div>

](/catalog?qlcampaign=1m-freelabs-456%3Futm_source%3Dgoogle "Catalog")[<ql-icon class="nav-panel__item__icon">event_note</ql-icon>

<div class="nav-panel__item__label">My Learning</div>

](/my_learning?qlcampaign=1m-freelabs-456%3Futm_source%3Dgoogle "My Learning")[<ql-icon class="nav-panel__item__icon">account_circle</ql-icon>

<div class="nav-panel__item__label">Profile</div>

](/my_account/profile?qlcampaign=1m-freelabs-456%3Futm_source%3Dgoogle "Profile")[<ql-icon class="nav-panel__item__icon">money</ql-icon>

<div class="nav-panel__item__label">Credits & Subscriptions</div>

](/my_account/credits?qlcampaign=1m-freelabs-456%3Futm_source%3Dgoogle "Credits & Subscriptions")[<ql-icon class="nav-panel__item__icon">security</ql-icon>

<div class="nav-panel__item__label">Security</div>

](/my_account/security?qlcampaign=1m-freelabs-456%3Futm_source%3Dgoogle "Security")[<ql-help>

<div class="nav-panel__help-item"><ql-icon class="nav-panel__item__icon">help</ql-icon>

<div class="nav-panel__item__label">Help</div>

</div>

</ql-help>](#)

<div class="nav-panel__small-links">[Privacy](/privacy_policy?qlcampaign=1m-freelabs-456%3Futm_source%3Dgoogle) [Terms](/terms_of_service?qlcampaign=1m-freelabs-456%3Futm_source%3Dgoogle)</div>

</nav>

<main class="js-main"><span class="hidden" id="flash-sibling-before"></span>

<div class="l-main-wrapper" id="main-wrapper">

<div class="lab-assessment__tab js-open-lab-assessment-panel">

###### —/100

</div>

<div class="lab-assessment__panel js-lab-assessment-panel">

<div class="lab-assessment__panel__header">

#### Checkpoints

<ql-icon-button class="js-close-lab-assessment-panel">arrow_forward</ql-icon-button></div>

<div class="lab-assessment__step">

Remove the overly permissive rules

<div class="lab-assessment__step__action"><a class="button js-show-run-step-button" step_no="1">Check my progress</a>

<span class="js-assessment-step-score-1"></span>/ 10

</div>

</div>

<div class="lab-assessment__step">

Start the bastion host instance

<div class="lab-assessment__step__action"><a class="button js-show-run-step-button" step_no="2">Check my progress</a>

<span class="js-assessment-step-score-2"></span>/ 10

</div>

</div>

<div class="lab-assessment__step">

Create a firewall rule that allows SSH (tcp/22) from the IAP service and add network tag on bastion

<div class="lab-assessment__step__action"><a class="button js-show-run-step-button" step_no="3">Check my progress</a>

<span class="js-assessment-step-score-3"></span>/ 20

</div>

</div>

<div class="lab-assessment__step">

Create a firewall rule that allows traffic on HTTP (tcp/80) to any address and add network tag on juice-shop

<div class="lab-assessment__step__action"><a class="button js-show-run-step-button" step_no="4">Check my progress</a>

<span class="js-assessment-step-score-4"></span>/ 20

</div>

</div>

<div class="lab-assessment__step">

Create a firewall rule that allows traffic on SSH (tcp/22) from acme-mgmt-subnet network address and add network tag on juice-shop

<div class="lab-assessment__step__action"><a class="button js-show-run-step-button" step_no="5">Check my progress</a>

<span class="js-assessment-step-score-5"></span>/ 20

</div>

</div>

<div class="lab-assessment__step">

SSH to bastion host via IAP and juice-shop via bastion

<div class="lab-assessment__step__action"><a class="button js-show-run-step-button" step_no="6">Check my progress</a>

<span class="js-assessment-step-score-6"></span>/ 20

</div>

</div>

</div>

<ql-drawer-container class="js-lab-state" data-analytics-payload="{&quot;label&quot;:&quot;Build and Secure Networks in Google Cloud: Challenge Lab&quot;,&quot;lab_name&quot;:&quot;Build and Secure Networks in Google Cloud: Challenge Lab&quot;,&quot;classroom_name&quot;:null,&quot;deployment&quot;:&quot;google-run&quot;}" data-focus-id="12068" data-lab-billing-limit="0.0" data-lab-duration="3600" data-parent="catalog" data-payment-required="" data-qlcampaign="1m-freelabs-456?utm_source=google" data-recaptcha-enabled="" id="lab-container"><ql-drawer id="terminal-drawer" slot="drawer"><ql-cloud-terminal class="terminal"></ql-cloud-terminal></ql-drawer><ql-drawer-content class="js-lab-wrapper" id="lab-content" slot="drawer-content"><ql-drawer-container id="lab-content-container"><ql-drawer id="control-panel-drawer" open="" slot="drawer" width="320"><ql-lab-control-panel class="ql-lab-control-panel__max-height control-panel js-lab-control-panel" connectionfiles="[]" labcontrolbutton="{&quot;disabled&quot;:false,&quot;pending&quot;:false,&quot;running&quot;:false}" labdetails="[]" labtimer="{&quot;ticking&quot;:false,&quot;secondsRemaining&quot;:3600}" studentresources="[]"><script>// Define function so that we can call it again later if we need to reset it // This executes reCAPTCHA and then calls our callback. function executeRecaptchaForStartLab() { grecaptcha.ready(function() { grecaptcha.execute('6LeVI8IUAAAAAJNdox5eTkYrw9SbvhZ1TFyv3iHr', {action: 'start_lab'}).then(function(token) { setInputWithRecaptchaResponseTokenForStartLab('g-recaptcha-response-data-start-lab', token) }); }); }; // Invoke immediately executeRecaptchaForStartLab() // Async variant so you can await this function from another async function (no need for // an explicit callback function then!) // Returns a Promise that resolves with the response token. async function executeRecaptchaForStartLabAsync() { return new Promise((resolve, reject) => { grecaptcha.ready(async function() { resolve(await grecaptcha.execute('6LeVI8IUAAAAAJNdox5eTkYrw9SbvhZ1TFyv3iHr', {action: 'start_lab'})) }); }) }; var setInputWithRecaptchaResponseTokenForStartLab = function(id, token) { var element = document.getElementById(id); element.value = token; }</script> <input type="hidden" name="g-recaptcha-response-data[start_lab]" id="g-recaptcha-response-data-start-lab" data-sitekey="6LeVI8IUAAAAAJNdox5eTkYrw9SbvhZ1TFyv3iHr" class="g-recaptcha g-recaptcha-response ">

<div class="hidden" id="recaptcha-v2-start-lab" slot="recaptcha">

<noscript>

<div>

<div style="width: 302px; height: 422px; position: relative;">

<div style="width: 302px; height: 422px; position: absolute;"><iframe src="https://www.recaptcha.net/recaptcha/api/fallback?k=6LeOI8IUAAAAAPkHlMAE9NReCD_1WD81iYlBlCnV" name="ReCAPTCHA" style="width: 302px; height: 422px; border-style: none; border: 0; overflow: hidden;"></iframe></div>

</div>

<div style="width: 300px; height: 60px; border-style: none;
                bottom: 12px; left: 25px; margin: 0px; padding: 0px; right: 25px;
                background: #f9f9f9; border: 1px solid #c1c1c1; border-radius: 3px;"><textarea id="g-recaptcha-response" name="g-recaptcha-response" class="g-recaptcha-response" style="width: 250px; height: 40px; border: 1px solid #c1c1c1;
                  margin: 10px 25px; padding: 0px; resize: none;"></textarea></div>

</div>

</noscript>

</div>

</ql-lab-control-panel></ql-drawer><ql-drawer-content id="lab-instructions" slot="drawer-content">

<div class="alert alert--fake js-alert"><a class="alert__close js-alert-close"></a><iframe class="l-ie-iframe-fix"></iframe></div>

<div class="js-lab-content lab-content__renderable-instructions">

<div class="lab-preamble">

# Build and Secure Networks in Google Cloud: Challenge Lab

<div class="lab-preamble__details subtitle-headline-1"><span>1 hour</span> <span>9 Credits</span>

<div class="lab__rating">[](/focuses/12068/reviews?parent=catalog&qlcampaign=1m-freelabs-456%3Futm_source%3Dgoogle)<a data-target="#lab-review-modal" data-toggle="modal">Rate Lab</a></div>

</div>

</div>

<div class="js-markdown-instructions markdown-lab-instructions" id="markdown-lab-instructions">

## GSP322

![Google Cloud Self-Paced Labs](https://cdn.qwiklabs.com/GMOHykaqmlTHiqEeQXTySaMXYPHeIvaqa2qHEzw6Occ%3D)

## Overview

For this Challenge Lab you must complete a series of tasks within a limited time period. Instead of following step-by-step instructions, you'll be given a scenario and task - you figure out how to complete it on your own! An automated scoring system (shown on this page) will provide feedback on whether you have completed your tasks correctly.

To score 100% you must complete all tasks within the time period!

When you take a Challenge Lab, you will not be taught Google Cloud concepts. You'll need to use your advanced Compute Engine and general Google Cloud skills to assess how to build the solution to the challenge presented. This lab is only recommended for students who have advanced Google Cloud and Compute Engine skills. Are you up for the challenge?

#### Topics tested

*   Secure remote ssh access via IAP-enabled bastion
*   Firewall configuration and review

### Prerequisites

*   Familiarity with VPC Networks
*   Firewall rules and network tags
*   IAP

## Setup

#### Before you click the Start Lab button

Read these instructions. Labs are timed and you cannot pause them. The timer, which starts when you click **Start Lab**, shows how long Google Cloud resources will be made available to you.

This Qwiklabs hands-on lab lets you do the lab activities yourself in a real cloud environment, not in a simulation or demo environment. It does so by giving you new, temporary credentials that you use to sign in and access Google Cloud for the duration of the lab.

#### What you need

To complete this lab, you need:

*   Access to a standard internet browser (Chrome browser recommended).
*   Time to complete the lab.

**Note:** If you already have your own personal Google Cloud account or project, do not use it for this lab.

**Note:** If you are using a Pixelbook, open an Incognito window to run this lab.

## Challenge scenario

You are a security consultant brought in by Jeff, who owns a small local company, to help him with his very successful website (juiceshop). Jeff is new to Google Cloud and had his neighbour's son set up the initial site. The neighbour's son has since had to leave for college, but before leaving, he made sure the site was running.

You need to help out Jeff and perform appropriate configuration for security. Below is the current situation:

![d1d45b80d0f8dec8.png](https://cdn.qwiklabs.com/qEwFTP7%2FkyF3cRwfT3FGObt7L7VLB60%2Bvp92hZVnogw%3D)

## Your challenge

You need to configure this simple environment securely. Your first challenge is to set up appropriate firewall rules and virtual machine tags. You also need to ensure that SSH is only available to the bastion via IAP.

For the firewall rules, make sure:

*   The bastion host does not have a public IP address.
*   You can only SSH to the bastion and only via IAP.
*   You can only SSH to juice-shop via the bastion.
*   Only HTTP is open to the world for `juice-shop`.

Tips and tricks:

*   Pay close attention to the network tags and the associated VPC firewall rules.
*   Be specific and limit the size of the VPC firewall rule source ranges.
*   Overly permissive permissions will not be marked correct.

![93b315830f8a2a1e.png](https://cdn.qwiklabs.com/BgxgsuLyqMkhxmO3jDlkHE7yGLIR%2B3rrUabKimlgrbo%3D)

Suggested order of actions:

1.  Check the firewall rules. Remove the overly permissive rules.

<ql-activity-tracking step="1">Remove the overly permissive rules</ql-activity-tracking>

1.  Navigate to Compute Engine in the Cloud Console and identify the bastion host. The instance should be stopped. Start the instance.

<ql-activity-tracking step="2">Start the bastion host instance</ql-activity-tracking>

1.  The bastion host is the one machine authorized to receive external SSH traffic. Create a firewall rule that allows [SSH (tcp/22) from the IAP service](https://cloud.google.com/iap/docs/using-tcp-forwarding). The firewall rule should be enabled on bastion via a network tag.

<ql-activity-tracking step="3">Create a firewall rule that allows SSH (tcp/22) from the IAP service and add network tag on bastion</ql-activity-tracking>

1.  The `juice-shop` server serves HTTP traffic. Create a firewall rule that allows traffic on HTTP (tcp/80) to any address. The firewall rule should be enabled on juice-shop via a network tag.

<ql-activity-tracking step="4">Create a firewall rule that allows traffic on HTTP (tcp/80) to any address and add network tag on juice-shop</ql-activity-tracking>

1.  You need to connect to `juice-shop` from the bastion using SSH. Create a firewall rule that allows traffic on SSH (tcp/22) from `acme-mgmt-subnet` network address. The firewall rule should be enabled on `juice-shop` via a network tag.

<ql-activity-tracking step="5">Create a firewall rule that allows traffic on SSH (tcp/22) from acme-mgmt-subnet</ql-activity-tracking>

1.  In the Compute Engine instances page, click the SSH button for the bastion host. Once connected, SSH to `juice-shop`.

<ql-activity-tracking step="6">SSH to bastion host via IAP and juice-shop via bastion</ql-activity-tracking>

## Congratulations!

You've completed the challenge lab and helped Jeff tighten security.

![Build_and_Secure_Networks_Skill_WB.png](https://cdn.qwiklabs.com/dEiCFd6lFVezPrlY5cNSAZdQIuR9GZWS4Z3TVdjFteo%3D)

### Take your next lab

This lab is also part of a series of labs called Challenge Labs. These labs are designed test your Google Cloud knowledge and skill. Search for "Challenge Lab" in the [lab catalog](http://google.qwiklabs.com/catalog) and challenge yourself!

### Google Cloud Training & Certification

...helps you make the most of Google Cloud technologies. [Our classes](https://cloud.google.com/training/courses) include technical skills and best practices to help you get up to speed quickly and continue your learning journey. We offer fundamental to advanced level training, with on-demand, live, and virtual options to suit your busy schedule. [Certifications](https://cloud.google.com/certification/) help you validate and prove your skill and expertise in Google Cloud technologies.

##### Manual Last Updated January 14, 2021

##### Manual Last Tested October 26, 2020

Copyright 2020 Google LLC All rights reserved. Google and the Google logo are trademarks of Google LLC. All other company and product names may be trademarks of the respective companies with which they are associated.

</div>

</div>

<div class="hidden js-end-lab-button-container lab-content__end-lab-button"><ql-lab-control-button class="js-end-lab-button" running=""></ql-lab-control-button></div>

<div class="lab-content__renderable-instructions">

<div class="lab-content__recommendation">

<section class="upcoming-cards">

## Continue questing

<div class="content-card-grid">

<div class="card-content-wrapper js-content-card" data-id="2728" data-level="Expert" data-name="Build and Secure Networks in Google Cloud: Challenge Lab" data-type="Lab">[

<div class="card__body">

<div class="overline card--content__type">Lab</div>

### Build and Secure Networks in Google Cloud: Challenge Lab

<div class="card--content__description body-1">

In this lab you will be challenged to secure remote SSH access and implement firewall rules.

</div>

</div>

<div class="card__footer">

<div class="card__footer__left"><span>Expert</span></div>

</div>

](/focuses/12068?parent=catalog&qlcampaign=1m-freelabs-456%3Futm_source%3Dgoogle)</div>

</div>

</section>

</div>

</div>
